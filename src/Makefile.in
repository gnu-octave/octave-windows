MKOCTFILE ?= @MKOCTFILE@

OLELIBS = @OLELIBS@

%.o: %.c ; $(MKOCTFILE) -c $< $(CXXFLAGS)
%.o: %.f ; $(MKOCTFILE) -c $< $(FFLAGS)
%.o: %.cc ; $(MKOCTFILE) -c $< $(CXXFLAGS)
%.oct: %.cc ; $(MKOCTFILE) $< $(CXXFLAGS)

PROGS=grab.oct win32api.oct __COM__.oct # ../inst/BROWER.m ../inst/image.m

ifeq ("@PKGWINQUERYREGFUNC@","winqueryreg")
  PROGS += winqueryreg.oct
endif

all: $(PROGS)

grab.oct: grab.o grab_win32part.o
	$(MKOCTFILE) -o $@ $^

win32api.oct: win32api.o win32api_win32part.o
	$(MKOCTFILE) -o $@ $^ $(OLELIBS)

winqueryreg.oct: winqueryreg.o win32api_win32part.o
	$(MKOCTFILE) -o $@ $^ $(OLELIBS)

__COM__.oct: __COM__.o
	$(MKOCTFILE) -o $@ $^ $(OLELIBS)

../inst/%.m : %.m.in
	if [ ! -d ../inst ]; then mkdir ../inst; fi
	cp $< $@

clean: ; -rm -f *.o core octave-core *.oct *~
