SHELL = @SHELL@

canonical_host_type = @canonical_host_type@
prefix = @prefix@
exec_prefix = @exec_prefix@
bindir = @bindir@
mandir = @mandir@
libdir = @libdir@
datadir = @datadir@
infodir = @infodir@
includedir = @includedir@
datarootdir = @datarootdir@

DESTDIR =

RANLIB = @RANLIB@
STRIP = @STRIP@
LN_S = @LN_S@

# Most octave programs will be compiled with $(MKOCTFILE).  Those which
# cannot use mkoctfile directly can request the flags that mkoctfile 
# would use as follows:
#    FLAG = $(shell $(MKOCTFILE) -p FLAG)
# The following flags are for compiling programs that are independent
# of Octave.  How confusing.
CC = @CC@
CFLAGS = @CFLAGS@
CPPFLAGS = @CPPFLAGS@
CPICFLAG = @CPICFLAG@
CXX = @CXX@
CXXFLAGS = @CXXFLAGS@
CXXPICFLAG = @CXXPICFLAG@
F77 = @F77@
FFLAGS = @FFLAGS@
FPICFLAG = @FPICFLAG@

OCTAVE = @OCTAVE@
OCTAVE_VERSION = @OCTAVE_VERSION@
MKOCTFILE = @MKOCTFILE@ -DHAVE_OCTAVE_$(ver) -v
OCTAVE_CONFIG = @OCTAVE_CONFIG@
SHLEXT = @SHLEXT@

ver = @ver@
MPATH = @mpath@
OPATH = @opath@
XPATH = @xpath@

%.o: %.c ; $(MKOCTFILE) -c $<
%.o: %.f ; $(MKOCTFILE) -c $<
%.o: %.cc ; $(MKOCTFILE) -c $<
%.oct: %.cc ; $(MKOCTFILE) $<

PROGS=grab.oct win32api.oct __COM__.oct # ../inst/BROWER.m ../inst/image.m

ifeq (,$(findstring -cygwin,$(canonical_host_type)))
  ifeq (,$(findstring -mingw,$(canonical_host_type)))
    ifeq (,$(findstring -msdosmsvc,$(canonical_host_type)))
all:
	@echo "Not building Windows Specific functions"
    else
all: $(PROGS)
    endif
  else
all: $(PROGS)
  endif
else
all: $(PROGS)
endif

grab.oct: grab.o grab_win32part.o
	$(MKOCTFILE) -o $@ $^ -luser32

win32api.oct: win32api.o win32api_win32part.o
	$(MKOCTFILE) -o $@ $^ -luser32 -ladvapi32

__COM__.oct: __COM__.o
	$(MKOCTFILE) -o $@ $^ -lole32 -loleaut32 -luser32 -luuid

../inst/%.m : %.m.in
	if [ ! -d ../inst ]; then mkdir ../inst; fi
	cp $< $@

clean: ; -rm -f *.o core octave-core *.oct *~
